<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Snake - Ali & Ainhoa</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&family=Playfair+Display:wght@600;700;800&display=swap"
      rel="stylesheet"
    />
    <style>
      :root {
        --font-body: 'Lato', sans-serif;
        --font-heading: 'Playfair Display', serif;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: var(--font-body);
        background: linear-gradient(135deg, #fdfdfd 0%, #ffffff 100%);
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        min-height: 100vh;
        padding: 20px;
      }

      body.dark-theme {
        background: linear-gradient(135deg, #1a1a1d 0%, #2a2a2d 100%);
      }

      .snake-container {
        max-width: 600px;
        width: 100%;
        text-align: center;
      }

      .snake-header {
        margin-bottom: 30px;
      }

      .snake-header h1 {
        font-family: var(--font-heading);
        font-size: clamp(2rem, 6vw, 3.5rem);
        color: #4a4a4a;
        margin-bottom: 10px;
      }

      body.dark-theme .snake-header h1 {
        color: #d8bfd8;
      }

      .game-info {
        display: flex;
        justify-content: space-around;
        margin-bottom: 20px;
        flex-wrap: wrap;
        gap: 15px;
      }

      .info-item {
        text-align: center;
      }

      .info-label {
        font-size: 12px;
        color: #999999;
        text-transform: uppercase;
        letter-spacing: 1px;
        margin-bottom: 5px;
      }

      body.dark-theme .info-label {
        color: #888888;
      }

      .info-value {
        font-size: 24px;
        font-weight: 700;
        color: #c2185b;
      }

      #gameCanvas {
        display: block;
        background: #ffffff;
        border: 2px solid #e0e0e0;
        border-radius: 12px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        width: 100%;
        max-width: 400px;
        aspect-ratio: 1;
        margin: 0 auto 20px;
      }

      body.dark-theme #gameCanvas {
        background: #2a2a2e;
        border-color: #3a3a3e;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
      }

      .controls {
        text-align: center;
        color: #999999;
        margin-bottom: 20px;
        font-size: 14px;
      }

      body.dark-theme .controls {
        color: #888888;
      }

      .controls p {
        margin: 8px 0;
      }

      .button-group {
        display: flex;
        gap: 15px;
        justify-content: center;
        flex-wrap: wrap;
      }

      button {
        padding: 12px 30px;
        font-size: 16px;
        font-family: var(--font-body);
        font-weight: 600;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.3s ease;
        text-transform: uppercase;
        letter-spacing: 1px;
      }

      .btn-primary {
        background: #c2185b;
        color: #ffffff;
      }

      .btn-primary:hover {
        background: #e91e63;
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(194, 24, 91, 0.3);
      }

      .btn-secondary {
        background: transparent;
        color: #4a4a4a;
        border: 2px solid #c2185b;
      }

      body.dark-theme .btn-secondary {
        color: #d8bfd8;
        border-color: #d8a5d8;
      }

      .btn-secondary:hover {
        background: #c2185b;
        color: #ffffff;
      }

      .theme-toggle {
        position: fixed;
        bottom: 20px;
        right: 20px;
        background: #ffffff;
        border: 1px solid #e0e0e0;
        color: #000000;
        width: 40px;
        height: 40px;
        border-radius: 50%;
        font-size: 1.1rem;
        cursor: pointer;
        box-shadow: none;
        transition: transform 0.3s ease, box-shadow 0.3s ease;
        z-index: 100;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .theme-toggle:hover {
        transform: scale(1.1);
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      }

      body.dark-theme .theme-toggle {
        background: #2a2a2e;
        border: 1px solid #3a3a3e;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        font-size: 1.1rem;
        color: #d8bfd8;
      }

      .back-link {
        position: fixed;
        bottom: 20px;
        left: 20px;
        background: #ffffff;
        border: 1px solid #e0e0e0;
        color: #000000;
        width: 40px;
        height: 40px;
        border-radius: 50%;
        font-size: 1.1rem;
        cursor: pointer;
        box-shadow: none;
        transition: transform 0.3s ease, box-shadow 0.3s ease;
        z-index: 100;
        display: flex;
        align-items: center;
        justify-content: center;
        text-decoration: none;
      }

      .back-link:hover {
        transform: scale(1.1);
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      }

      body.dark-theme .back-link {
        background: #2a2a2e;
        border: 1px solid #3a3a3e;
        color: #d8bfd8;
      }

      @media (max-width: 480px) {
        .button-group {
          gap: 10px;
        }

        button {
          padding: 10px 20px;
          font-size: 14px;
        }
      }
    </style>
  </head>
  <body>
    <a href="games.html" class="back-link" title="Volver a juegos">‚Üê</a>
    <button class="theme-toggle" id="theme-toggle" title="Cambiar tema">
      üåô
    </button>

    <div class="snake-container">
      <div class="snake-header">
        <h1>Snake</h1>
      </div>

      <div class="game-info">
        <div class="info-item">
          <div class="info-label">Puntuaci√≥n</div>
          <div class="info-value" id="score">0</div>
        </div>
        <div class="info-item">
          <div class="info-label">Velocidad</div>
          <div class="info-value" id="level">1</div>
        </div>
      </div>

      <canvas id="gameCanvas" width="400" height="400"></canvas>

      <div class="controls">
        <p><strong>Escritorio:</strong> ‚Üê ‚Üí ‚Üë ‚Üì para mover</p>
        <p>
          <strong>M√≥vil:</strong> Desliza para mover | WASD tambi√©n funciona
        </p>
      </div>

      <div class="button-group">
        <button class="btn-primary" onclick="toggleGame()">
          Pausa/Reanudar
        </button>
        <button class="btn-primary" onclick="initGame()">Nuevo Juego</button>
        <button
          class="btn-secondary"
          onclick="window.location.href='games.html'"
        >
          Volver
        </button>
      </div>
    </div>

    <script>
      const canvas = document.getElementById('gameCanvas');
      const ctx = canvas.getContext('2d');

      const gridSize = 20;
      const tileCount = canvas.width / gridSize;

      let snake = [{ x: 10, y: 10 }];
      let food = { x: 15, y: 15 };
      let direction = { x: 1, y: 0 };
      let nextDirection = { x: 1, y: 0 };
      let score = 0;
      let level = 1;
      let gameRunning = true;
      let isPaused = false;
      let gameSpeed = 6;
      let frameCount = 0;
      let touchStartX = 0;
      let touchStartY = 0;

      const keys = {};

      window.addEventListener('keydown', (e) => {
        keys[e.key] = true;
        handleKeyPress(e.key);
      });

      window.addEventListener('keyup', (e) => {
        keys[e.key] = false;
      });

      function handleKeyPress(key) {
        switch (key) {
          case 'ArrowLeft':
          case 'a':
          case 'A':
            if (direction.x === 0) nextDirection = { x: -1, y: 0 };
            break;
          case 'ArrowRight':
          case 'd':
          case 'D':
            if (direction.x === 0) nextDirection = { x: 1, y: 0 };
            break;
          case 'ArrowUp':
          case 'w':
          case 'W':
            if (direction.y === 0) nextDirection = { x: 0, y: -1 };
            break;
          case 'ArrowDown':
          case 's':
          case 'S':
            if (direction.y === 0) nextDirection = { x: 0, y: 1 };
            break;
        }
      }

      // Controles t√°ctiles
      canvas.addEventListener(
        'touchstart',
        (e) => {
          touchStartX = e.touches[0].clientX;
          touchStartY = e.touches[0].clientY;
        },
        false,
      );

      canvas.addEventListener(
        'touchmove',
        (e) => {
          e.preventDefault();
        },
        false,
      );

      canvas.addEventListener(
        'touchend',
        (e) => {
          const touchEndX = e.changedTouches[0].clientX;
          const touchEndY = e.changedTouches[0].clientY;

          const deltaX = touchEndX - touchStartX;
          const deltaY = touchEndY - touchStartY;

          const minDistance = 30;

          if (Math.abs(deltaX) > Math.abs(deltaY)) {
            if (Math.abs(deltaX) > minDistance) {
              if (deltaX > 0 && direction.x === 0) {
                nextDirection = { x: 1, y: 0 };
              } else if (deltaX < 0 && direction.x === 0) {
                nextDirection = { x: -1, y: 0 };
              }
            }
          } else {
            if (Math.abs(deltaY) > minDistance) {
              if (deltaY > 0 && direction.y === 0) {
                nextDirection = { x: 0, y: 1 };
              } else if (deltaY < 0 && direction.y === 0) {
                nextDirection = { x: 0, y: -1 };
              }
            }
          }
        },
        false,
      );

      function spawnFood() {
        let newFood;
        let foodOnSnake = true;

        while (foodOnSnake) {
          newFood = {
            x: Math.floor(Math.random() * tileCount),
            y: Math.floor(Math.random() * tileCount),
          };

          foodOnSnake = snake.some(
            (segment) => segment.x === newFood.x && segment.y === newFood.y,
          );
        }

        food = newFood;
      }

      function update() {
        if (isPaused) return;

        frameCount++;
        if (frameCount < gameSpeed) return;
        frameCount = 0;

        direction = nextDirection;

        const head = {
          x: snake[0].x + direction.x,
          y: snake[0].y + direction.y,
        };

        // Verificar colisiones con paredes
        if (
          head.x < 0 ||
          head.x >= tileCount ||
          head.y < 0 ||
          head.y >= tileCount
        ) {
          endGame();
          return;
        }

        // Verificar colisiones con el cuerpo
        if (
          snake.some((segment) => segment.x === head.x && segment.y === head.y)
        ) {
          endGame();
          return;
        }

        snake.unshift(head);

        // Verificar si come comida
        if (head.x === food.x && head.y === food.y) {
          score += 10;
          level = Math.floor(score / 50) + 1;
          gameSpeed = Math.max(3, 6 - level * 0.2);
          spawnFood();
          updateInfo();
        } else {
          snake.pop();
        }
      }

      function draw() {
        // Fondo
        ctx.fillStyle = '#ffffff';
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        if (document.body.classList.contains('dark-theme')) {
          ctx.fillStyle = '#2a2a2e';
          ctx.fillRect(0, 0, canvas.width, canvas.height);
        }

        // Grid
        ctx.strokeStyle = document.body.classList.contains('dark-theme')
          ? 'rgba(255, 255, 255, 0.05)'
          : 'rgba(0, 0, 0, 0.05)';
        ctx.lineWidth = 0.5;

        for (let i = 0; i <= tileCount; i++) {
          ctx.beginPath();
          ctx.moveTo(i * gridSize, 0);
          ctx.lineTo(i * gridSize, canvas.height);
          ctx.stroke();

          ctx.beginPath();
          ctx.moveTo(0, i * gridSize);
          ctx.lineTo(canvas.width, i * gridSize);
          ctx.stroke();
        }

        // Dibujar serpiente
        snake.forEach((segment, index) => {
          if (index === 0) {
            ctx.fillStyle = '#c2185b';
            ctx.shadowColor = 'rgba(194, 24, 91, 0.5)';
            ctx.shadowBlur = 10;
          } else {
            ctx.fillStyle = '#e91e63';
            ctx.shadowColor = 'transparent';
          }

          ctx.fillRect(
            segment.x * gridSize + 1,
            segment.y * gridSize + 1,
            gridSize - 2,
            gridSize - 2,
          );

          ctx.shadowColor = 'transparent';
        });

        // Dibujar comida
        ctx.fillStyle = '#FFD700';
        ctx.shadowColor = 'rgba(255, 215, 0, 0.5)';
        ctx.shadowBlur = 8;
        ctx.beginPath();
        ctx.arc(
          food.x * gridSize + gridSize / 2,
          food.y * gridSize + gridSize / 2,
          gridSize / 2 - 2,
          0,
          Math.PI * 2,
        );
        ctx.fill();
        ctx.shadowColor = 'transparent';
      }

      function updateInfo() {
        document.getElementById('score').textContent = score;
        document.getElementById('level').textContent = level;
      }

      function endGame() {
        gameRunning = false;
        gameSpeed = 0;
        alert(`¬°Juego Terminado!\nPuntuaci√≥n: ${score}\nNivel: ${level}`);
      }

      function toggleGame() {
        if (gameRunning) {
          isPaused = !isPaused;
        }
      }

      function initGame() {
        snake = [{ x: 10, y: 10 }];
        direction = { x: 1, y: 0 };
        nextDirection = { x: 1, y: 0 };
        score = 0;
        level = 1;
        gameRunning = true;
        isPaused = false;
        gameSpeed = 6;
        frameCount = 0;
        spawnFood();
        updateInfo();
        gameLoop();
      }

      function gameLoop() {
        update();
        draw();
        requestAnimationFrame(gameLoop);
      }

      const themeToggle = document.getElementById('theme-toggle');
      const savedTheme = localStorage.getItem('theme') || 'light';
      if (savedTheme === 'dark') {
        document.body.classList.add('dark-theme');
        themeToggle.textContent = '‚òÄÔ∏è';
      }

      themeToggle.addEventListener('click', () => {
        document.body.classList.toggle('dark-theme');
        const isDark = document.body.classList.contains('dark-theme');
        localStorage.setItem('theme', isDark ? 'dark' : 'light');
        themeToggle.textContent = isDark ? '‚òÄÔ∏è' : 'üåô';
        draw();
      });

      initGame();
    </script>
  </body>
</html>
