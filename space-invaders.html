<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Space Invaders - Ali & Ainhoa</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&family=Playfair+Display:wght@600;700;800&display=swap"
      rel="stylesheet"
    />
    <style>
      :root {
        --font-body: 'Lato', sans-serif;
        --font-heading: 'Playfair Display', serif;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: var(--font-body);
        background: #000000;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        min-height: 100vh;
        padding: 20px;
      }

      body.dark-theme {
        background: #000000;
      }

      .game-wrapper {
        width: 100%;
        max-width: 600px;
      }

      .game-header {
        text-align: center;
        margin-bottom: 20px;
      }

      .game-header h1 {
        font-family: var(--font-heading);
        color: #00ff00;
        font-size: 32px;
        margin-bottom: 10px;
        text-shadow: 0 0 10px #00ff00;
      }

      .game-info {
        display: flex;
        justify-content: space-around;
        color: #00ff00;
        font-weight: 700;
        margin-bottom: 20px;
        font-size: 16px;
      }

      #gameCanvas {
        display: block;
        background: #1a1a2e;
        border: 3px solid #00ff00;
        box-shadow: 0 0 20px rgba(0, 255, 0, 0.5);
        width: 100%;
        max-width: 600px;
        aspect-ratio: 600 / 400;
      }

      .controls {
        text-align: center;
        color: #00ff00;
        margin-top: 20px;
        font-size: 14px;
      }

      .controls p {
        margin: 8px 0;
      }

      .button-group {
        display: flex;
        gap: 15px;
        justify-content: center;
        margin-top: 20px;
      }

      button {
        padding: 12px 30px;
        font-size: 16px;
        font-family: var(--font-body);
        font-weight: 600;
        border: 2px solid #00ff00;
        background: transparent;
        color: #00ff00;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.3s ease;
        text-transform: uppercase;
        letter-spacing: 1px;
      }

      button:hover {
        background: #00ff00;
        color: #000000;
        box-shadow: 0 0 10px rgba(0, 255, 0, 0.5);
      }

      .theme-toggle {
        position: fixed;
        bottom: 20px;
        right: 20px;
        background: #1a1a2e;
        border: 1px solid #00ff00;
        color: #00ff00;
        width: 40px;
        height: 40px;
        border-radius: 50%;
        font-size: 1.1rem;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 0 10px rgba(0, 255, 0, 0.3);
      }

      .theme-toggle:hover {
        transform: scale(1.1);
        box-shadow: 0 0 15px rgba(0, 255, 0, 0.6);
      }

      .back-link {
        position: fixed;
        bottom: 20px;
        left: 20px;
        background: #1a1a2e;
        border: 1px solid #00ff00;
        color: #00ff00;
        width: 40px;
        height: 40px;
        border-radius: 50%;
        font-size: 1.1rem;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        text-decoration: none;
        box-shadow: 0 0 10px rgba(0, 255, 0, 0.3);
      }

      .back-link:hover {
        transform: scale(1.1);
        box-shadow: 0 0 15px rgba(0, 255, 0, 0.6);
      }
    </style>
  </head>
  <body>
    <a href="games.html" class="back-link" title="Volver a juegos">‚Üê</a>
    <button class="theme-toggle" id="theme-toggle" title="Cambiar tema">
      üåô
    </button>

    <div class="game-wrapper">
      <div class="game-header">
        <h1>SPACE INVADERS</h1>
      </div>

      <div class="game-info">
        <div>Score: <span id="score">0</span></div>
        <div>Lives: <span id="lives">3</span></div>
        <div>Wave: <span id="wave">1</span></div>
      </div>

      <canvas id="gameCanvas" width="600" height="400"></canvas>

      <div class="controls">
        <p>
          <strong>Escritorio:</strong> ‚Üê ‚Üí para mover | ESPACIO para disparar
        </p>
        <p><strong>M√≥vil:</strong> Desliza para mover | Toca para disparar</p>
        <p id="gameStatus"></p>
      </div>

      <div class="button-group">
        <button onclick="toggleGame()">Pausa/Reanudar</button>
        <button onclick="initGame()">Nuevo Juego</button>
        <button onclick="window.location.href='games.html'">Volver</button>
      </div>
    </div>

    <script>
      const canvas = document.getElementById('gameCanvas');
      const ctx = canvas.getContext('2d');

      let gameRunning = true;
      let isPaused = false;

      const player = {
        x: canvas.width / 2 - 15,
        y: canvas.height - 30,
        width: 30,
        height: 20,
        speed: 5,
        dx: 0,
      };

      let bullets = [];
      let enemies = [];
      let score = 0;
      let lives = 3;
      let wave = 1;
      let touchStartX = 0;
      let isTouchDevice = false;

      const keys = {};

      window.addEventListener('keydown', (e) => {
        keys[e.key] = true;
        if (e.key === ' ') {
          e.preventDefault();
          shoot();
        }
      });

      window.addEventListener('keyup', (e) => {
        keys[e.key] = false;
      });

      // Detectar si es dispositivo t√°ctil
      function detectTouchDevice() {
        return (
          'ontouchstart' in window ||
          navigator.maxTouchPoints > 0 ||
          navigator.msMaxTouchPoints > 0
        );
      }

      isTouchDevice = detectTouchDevice();

      // Controles t√°ctiles
      canvas.addEventListener(
        'touchstart',
        (e) => {
          if (!isTouchDevice) return;
          touchStartX = e.touches[0].clientX;
          shoot();
        },
        false,
      );

      canvas.addEventListener(
        'touchmove',
        (e) => {
          if (!isTouchDevice) return;
          e.preventDefault();

          const touch = e.touches[0];
          const moveX = touch.clientX - touchStartX;

          // Mover jugador seg√∫n movimiento t√°ctil
          player.x += moveX * 0.5;
          player.x = Math.max(
            0,
            Math.min(canvas.width - player.width, player.x),
          );

          touchStartX = touch.clientX;
        },
        false,
      );

      // Disparar al tocar m√∫ltiples veces r√°pido
      let lastTouchTime = 0;
      canvas.addEventListener(
        'touchend',
        (e) => {
          const currentTime = new Date().getTime();
          const timeDiff = currentTime - lastTouchTime;

          if (timeDiff < 300) {
            shoot();
          }
          lastTouchTime = currentTime;
        },
        false,
      );

      function shoot() {
        if (gameRunning && !isPaused) {
          bullets.push({
            x: player.x + player.width / 2 - 2,
            y: player.y,
            width: 4,
            height: 10,
            speed: 7,
          });
        }
      }

      function spawnEnemies() {
        enemies = [];
        const enemyCount = 3 + wave;
        for (let i = 0; i < enemyCount; i++) {
          enemies.push({
            x: Math.random() * (canvas.width - 30),
            y: Math.random() * 50 + 20,
            width: 30,
            height: 20,
            speed: 1 + wave * 0.5,
            dx: Math.random() > 0.5 ? 1 : -1,
          });
        }
      }

      function update() {
        if (isPaused) return;

        // Mover jugador
        if (keys['ArrowLeft'] || keys['a']) {
          player.x = Math.max(0, player.x - player.speed);
        }
        if (keys['ArrowRight'] || keys['d']) {
          player.x = Math.min(
            canvas.width - player.width,
            player.x + player.speed,
          );
        }

        // Mover balas
        bullets = bullets.filter((bullet) => bullet.y > 0);
        bullets.forEach((bullet) => {
          bullet.y -= bullet.speed;
        });

        // Mover enemigos
        enemies.forEach((enemy) => {
          enemy.x += enemy.speed * enemy.dx;

          if (enemy.x <= 0 || enemy.x + enemy.width >= canvas.width) {
            enemy.dx *= -1;
            enemy.y += 30;
          }

          if (enemy.y > canvas.height) {
            lives--;
            updateInfo();
            if (lives <= 0) {
              gameRunning = false;
              document.getElementById('gameStatus').textContent =
                '¬°Game Over! Presiona Nuevo Juego';
            }
          }
        });

        // Detectar colisiones
        bullets.forEach((bullet, bulletIndex) => {
          enemies.forEach((enemy, enemyIndex) => {
            if (
              bullet.x < enemy.x + enemy.width &&
              bullet.x + bullet.width > enemy.x &&
              bullet.y < enemy.y + enemy.height &&
              bullet.y + bullet.height > enemy.y
            ) {
              bullets.splice(bulletIndex, 1);
              enemies.splice(enemyIndex, 1);
              score += 10;
              updateInfo();

              if (enemies.length === 0) {
                wave++;
                spawnEnemies();
              }
            }
          });
        });
      }

      function draw() {
        // Limpiar canvas
        ctx.fillStyle = '#1a1a2e';
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        // Dibujar grid
        ctx.strokeStyle = 'rgba(0, 255, 0, 0.1)';
        ctx.lineWidth = 1;
        for (let i = 0; i < canvas.width; i += 30) {
          ctx.beginPath();
          ctx.moveTo(i, 0);
          ctx.lineTo(i, canvas.height);
          ctx.stroke();
        }
        for (let i = 0; i < canvas.height; i += 30) {
          ctx.beginPath();
          ctx.moveTo(0, i);
          ctx.lineTo(canvas.width, i);
          ctx.stroke();
        }

        // Dibujar jugador
        ctx.fillStyle = '#00ff00';
        ctx.fillRect(player.x, player.y, player.width, player.height);
        ctx.fillStyle = '#ffff00';
        ctx.fillRect(player.x + 10, player.y - 5, 10, 5);

        // Dibujar balas
        ctx.fillStyle = '#ffff00';
        bullets.forEach((bullet) => {
          ctx.fillRect(bullet.x, bullet.y, bullet.width, bullet.height);
        });

        // Dibujar enemigos
        ctx.fillStyle = '#ff0000';
        enemies.forEach((enemy) => {
          ctx.fillRect(enemy.x, enemy.y, enemy.width, enemy.height);
          ctx.fillStyle = '#ff6600';
          ctx.fillRect(enemy.x + 5, enemy.y + 5, 8, 8);
          ctx.fillStyle = '#ff0000';
        });
      }

      function gameLoop() {
        update();
        draw();
        requestAnimationFrame(gameLoop);
      }

      function updateInfo() {
        document.getElementById('score').textContent = score;
        document.getElementById('lives').textContent = lives;
        document.getElementById('wave').textContent = wave;
      }

      function toggleGame() {
        if (gameRunning) {
          isPaused = !isPaused;
          document.getElementById('gameStatus').textContent = isPaused
            ? 'PAUSADO'
            : '';
        }
      }

      function initGame() {
        score = 0;
        lives = 3;
        wave = 1;
        gameRunning = true;
        isPaused = false;
        bullets = [];
        player.x = canvas.width / 2 - 15;
        document.getElementById('gameStatus').textContent = '';
        spawnEnemies();
        updateInfo();
      }

      const themeToggle = document.getElementById('theme-toggle');
      themeToggle.addEventListener('click', () => {
        document.body.classList.toggle('dark-theme');
        const isDark = document.body.classList.contains('dark-theme');
        localStorage.setItem('theme', isDark ? 'dark' : 'light');
      });

      initGame();
      gameLoop();
    </script>
  </body>
</html>
